<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">

<head>
    <!--/*/ <th:block th:include="common :: head"></th:block> /*/-->
</head>

<body class="kt-page--fluid kt-header--fixed kt-header--minimize-menu kt-header-mobile--fixed kt-subheader--enabled kt-subheader--transparent">

<div th:replace="common :: header"></div>

<div class="kt-grid kt-grid--hor kt-grid--root">
    <div class="kt-grid__item kt-grid__item--fluid kt-grid kt-grid--ver kt-page">
        <div class="kt-grid__item kt-grid__item--fluid kt-grid kt-grid--hor kt-wrapper" id="kt_wrapper">
            <div class="kt-grid__item kt-grid__item--fluid kt-grid kt-grid--ver kt-grid--stretch">
                <div class="kt-container kt-body  kt-grid kt-grid--ver" id="kt_body">
                    <div class="kt-grid__item kt-grid__item--fluid kt-grid kt-grid--hor">

                        <!-- begin:: Subheader -->
                        <div class="kt-subheader   kt-grid__item" id="kt_subheader" style="padding: 10px 0 !important;">
                            <div class="kt-subheader__main">
                                <span class="kt-subheader__separator kt-hidden"></span>
                                <div class="kt-subheader__breadcrumbs">
                                    <a class="kt-subheader__breadcrumbs-home" th:href="@{/}"><i
                                            class="flaticon2-shelter"></i></a>
                                    <span class="kt-subheader__breadcrumbs-separator"></span>
                                    <!--<a href="" class="kt-subheader__breadcrumbs-link">
                                        Cuenta </a>-->

                                    <span class="kt-subheader__breadcrumbs-link kt-subheader__breadcrumbs-link--active">Indicador Risk Ratios</span>
                                </div>
                            </div>
                        </div>
                        <!-- end:: Subheader -->

                        <!--Begin::  Content-->
                        <div class="kt-content kt-grid__item kt-grid__item--fluid" id="kt_content"
                             style="margin-bottom: 50px;">
                            <div class="row">
                                <div class="col-xl-12">
                                    <div class="kt-portlet">
                                        <div class="kt-portlet__head">
                                            <div class="kt-portlet__head-label">
                                                <h3 class="kt-portlet__head-title">Risk Ratios
                                                    <small>Indicador Risk Ratios para tu propia empresa</small>
                                                </h3>
                                            </div>
                                            <div class="kt-portlet__head-toolbar" th:if="${dataintegration != null}">
                                                <ul class="nav nav-tabs nav-tabs-line nav-tabs-bold nav-tabs-line-brand nav-tabs-line-info"
                                                    role="tablist">
                                                    <li class="nav-item">
                                                        <a class="nav-link active"
                                                           role="tab" th:href="@{/indicators/riskratios/setting}"
                                                           style="font-weight: 900 !important;" ;>
                                                            <i class="flaticon2-gear"></i>
                                                            Nueva configuración
                                                        </a>
                                                    </li>
                                                </ul>
                                            </div>
                                        </div>
                                        <form class="kt-form kt-form--label-right">
                                            <div class="kt-portlet__body">
                                                <div class="kt-section" style="margin: 0 0 0 0;">
                                                    <div class="kt-section__body">
                                                        <div class="row">
                                                            <div class="col-lg-12">
                                                                <h3 class="kt-portlet__head-title">Risk Ratios</small>
                                                                </h3>
                                                            </div>
                                                        </div>
                                                        <div class="row"
                                                             th:if="${dataintegration != null and riskratio != null}">
                                                            <div class="col-lg-12">
                                                                <form class="kt-form" id="kt_form"
                                                                      novalidate="novalidate">
                                                                    <!--begin: Form Wizard Step 3-->
                                                                    <div class="kt-wizard-v3__content">
                                                                        <div class="kt-heading kt-heading--md">Resumen
                                                                            de la configuración actual del indicador
                                                                        </div>
                                                                        <div class="kt-form__section kt-form__section--first">
                                                                            <div class="kt-wizard-v3__review">
                                                                                <div class="kt-wizard-v3__review-item">
                                                                                    <div class="form-group">
                                                                                        <div class="form-group">
                                                                                            <label>Detalles
                                                                                                de los ratios
                                                                                                configurados:</label>
                                                                                        </div>
                                                                                        <div th:each="ratio : ${riskratio.riskRatiosRatiosCollection}">
                                                                                            <div class="form-group row">
                                                                                                <div class="col-3">
                                                                                                    <label>Titulo:</label>
                                                                                                </div>
                                                                                                <div class="col-3">
                                                                                                    <strong class="text-info"
                                                                                                            th:text="${ratio.titule}"></strong>
                                                                                                </div>
                                                                                                <div class="col-3">
                                                                                                    <label>Expresión
                                                                                                        matemática:</label>
                                                                                                </div>
                                                                                                <div class="col-3">
                                                                                                    <strong class="text-info"
                                                                                                            th:text="${ratio.expression}"></strong>
                                                                                                </div>
                                                                                                <div class="col-3">
                                                                                                    <label>Sufijo
                                                                                                        (Opcional):</label>
                                                                                                </div>
                                                                                                <div class="col-3">
                                                                                                    <strong class="text-info"
                                                                                                            th:text="${ratio.postResult == null ? '' : ratio.postResult}"></strong>
                                                                                                </div>
                                                                                                <div class="col-3">
                                                                                                    <label>Color:</label>
                                                                                                </div>
                                                                                                <div class="col-3">
                                                                                                    <input class="form-control"
                                                                                                           disabled=""
                                                                                                           type="color"
                                                                                                           th:value="${ratio.color}">
                                                                                                </div>
                                                                                            </div>
                                                                                        </div>
                                                                                    </div>
                                                                                </div>
                                                                                <div class="kt-separator kt-separator--border-dashed kt-separator--space-lg"></div>
                                                                                <div class="kt-wizard-v3__review-item">
                                                                                    <div class="kt-wizard-v3__review-title">
                                                                                        Vista previa del gráfico del
                                                                                        indicador
                                                                                    </div>
                                                                                    <div class="kt-wizard-v3__review-content">
                                                                                        <div class="outer">
                                                                                            <div class="chart-container"
                                                                                                 id="content_score_graphic">
                                                                                            </div>
                                                                                        </div>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                            <div class="kt-wizard-v3__review">
                                                                                <div class="row">
                                                                                    <div class="col-lg-3">
                                                                                        <div class="kt-portlet kt-portlet--skin-solid kt-portlet--"
                                                                                             id="background_ratio1">
                                                                                            <div class="kt-portlet__head">
                                                                                                <div class="kt-portlet__head-label">
                                                                            <span class="kt-portlet__head-icon">
                                                                                <i class="flaticon-star"></i>
                                                                            </span>
                                                                                                    <h1 class="kt-portlet__head-title"
                                                                                                        style="white-space: nowrap;overflow: hidden;text-overflow: ellipsis;"
                                                                                                        id="titule_ratio1">
                                                                                                    </h1>
                                                                                                </div>
                                                                                            </div>
                                                                                            <div class="kt-portlet__body">
                                                                                                <h1 class="text-right"
                                                                                                    id="result_ratio1"
                                                                                                    style="white-space: nowrap;overflow: hidden;text-overflow: ellipsis;">
                                                                                                    --</h1>
                                                                                                <small id="operation_ratio1">--</small>
                                                                                            </div>
                                                                                        </div>
                                                                                    </div>
                                                                                    <div class="col-lg-3">
                                                                                        <div class="kt-portlet kt-portlet--skin-solid kt-portlet--"
                                                                                             id="background_ratio2">
                                                                                            <div class="kt-portlet__head">
                                                                                                <div class="kt-portlet__head-label">
                                                                            <span class="kt-portlet__head-icon">
                                                                                <i class="flaticon-star"></i>
                                                                            </span>
                                                                                                    <h1 class="kt-portlet__head-title"
                                                                                                        style="white-space: nowrap;overflow: hidden;text-overflow: ellipsis;"
                                                                                                        id="titule_ratio2">
                                                                                                    </h1>
                                                                                                </div>
                                                                                            </div>
                                                                                            <div class="kt-portlet__body">
                                                                                                <h1 class="text-right"
                                                                                                    id="result_ratio2"
                                                                                                    style="white-space: nowrap;overflow: hidden;text-overflow: ellipsis;">
                                                                                                    --</h1>
                                                                                                <small id="operation_ratio2">--</small>
                                                                                            </div>
                                                                                        </div>
                                                                                    </div>
                                                                                    <div class="col-lg-3">
                                                                                        <div class="kt-portlet kt-portlet--skin-solid kt-portlet--"
                                                                                             id="background_ratio3">
                                                                                            <div class="kt-portlet__head">
                                                                                                <div class="kt-portlet__head-label">
                                                                            <span class="kt-portlet__head-icon">
                                                                                <i class="flaticon-star"></i>
                                                                            </span>
                                                                                                    <h1 class="kt-portlet__head-title"
                                                                                                        style="white-space: nowrap;overflow: hidden;text-overflow: ellipsis;"
                                                                                                        id="titule_ratio3">
                                                                                                    </h1>
                                                                                                </div>
                                                                                            </div>
                                                                                            <div class="kt-portlet__body">
                                                                                                <h1 class="text-right"
                                                                                                    id="result_ratio3"
                                                                                                    style="white-space: nowrap;overflow: hidden;text-overflow: ellipsis;">
                                                                                                    --</h1>
                                                                                                <small id="operation_ratio3">--</small>
                                                                                            </div>
                                                                                        </div>
                                                                                    </div>
                                                                                    <div class="col-lg-3">
                                                                                        <div class="kt-portlet kt-portlet--skin-solid kt-portlet--"
                                                                                             id="background_ratio4">
                                                                                            <div class="kt-portlet__head">
                                                                                                <div class="kt-portlet__head-label">
                                                                            <span class="kt-portlet__head-icon">
                                                                                <i class="flaticon-star"></i>
                                                                            </span>
                                                                                                    <h1 class="kt-portlet__head-title"
                                                                                                        style="white-space: nowrap;overflow: hidden;text-overflow: ellipsis;"
                                                                                                        id="titule_ratio4">
                                                                                                    </h1>
                                                                                                </div>
                                                                                            </div>
                                                                                            <div class="kt-portlet__body">
                                                                                                <h1 class="text-right"
                                                                                                    id="result_ratio4"
                                                                                                    style="white-space: nowrap;overflow: hidden;text-overflow: ellipsis;">
                                                                                                    --</h1>
                                                                                                <small id="operation_ratio4">--</small>
                                                                                            </div>
                                                                                        </div>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </form>
                                                            </div>
                                                        </div>
                                                        <div class="row"
                                                             th:if="${dataintegration != null and riskratio == null}">
                                                            <div class="col-12 alert alert-warning" role="alert"
                                                                 style="margin-top: 30px">
                                                                <label>
                                                                    <strong style="margin-right: 8px;">Cuidado!</strong>
                                                                    Actualmente no está configurado el <strong>indicador
                                                                    Risk Ratios</strong>. Por favor ir a
                                                                    Indicadores > Risk Ratios >
                                                                    <strong>
                                                                        <a style="color: #ffffff;"
                                                                           th:href="@{/indicators/riskratios/setting}">Nueva
                                                                            configuración</a>
                                                                    </strong>
                                                                </label>
                                                            </div>
                                                        </div>
                                                        <div class="row" th:if="${dataintegration == null}">
                                                            <div class="col-12 alert alert-danger" role="alert"
                                                                 style="margin-top: 30px">
                                                                <label>
                                                                    <strong style="margin-right: 8px;">Problemas!</strong>
                                                                    Actualmente no está configurado <strong>Data
                                                                    Integration</strong>. Por favor ir a
                                                                    Data Integration >
                                                                    <strong>
                                                                        <a style="color: #ffffff;"
                                                                           th:href="@{/dataintegration/setting}">Nueva
                                                                            configuración</a>
                                                                    </strong>
                                                                </label>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!--End::  Content-->
                    </div>
                </div>
            </div>


        </div>
    </div>
</div>

<div th:replace="common :: footer"></div>
<!--/*/ <th:block th:include="common :: scripts"></th:block> /*/-->
<script th:src="@{/vendors/custom/highcharts/highcharts.js}" type="text/javascript"
        th:if="${dataintegration != null and riskratio != null}"></script>
<script th:src="@{/vendors/custom/highcharts/highcharts-more.js}" type="text/javascript"
        th:if="${dataintegration != null and riskratio != null}"></script>
<script th:src="@{/vendors/custom/highcharts/modules/solid-gauge.js}" type="text/javascript"
        th:if="${dataintegration != null and riskratio != null}"></script>
<script type="text/javascript" th:inline="javascript" th:if="${dataintegration != null and riskratio != null}">
    var interval;
    jQuery(document).ready(function () {
        /*<![CDATA[*/
        var riskratio = /*[[${riskratio}]]*/ undefined;
        /*]]>*/

        var ratio1 = riskratio.riskRatiosRatiosCollection[0];
        var ratio2 = riskratio.riskRatiosRatiosCollection[1];
        var ratio3 = riskratio.riskRatiosRatiosCollection[2];
        var ratio4 = riskratio.riskRatiosRatiosCollection[3];
        handleRatios(1, ratio1["titule"], ratio1["expression"], parseInt(Math.round((Math.random() * 100000.2) + 500)), ratio1["postResult"], ratio1["color"]);
        handleRatios(2, ratio2["titule"], ratio2["expression"], parseInt(Math.round((Math.random() * 100000.2) + 500)), ratio2["postResult"], ratio2["color"]);
        handleRatios(3, ratio3["titule"], ratio3["expression"], parseInt(Math.round((Math.random() * 100000.2) + 500)), ratio3["postResult"], ratio3["color"]);
        handleRatios(4, ratio4["titule"], ratio4["expression"], parseInt(Math.round((Math.random() * 100000.2) + 500)), ratio4["postResult"], ratio4["color"]);
        if (interval != undefined) {
            clearInterval(interval);
        }
        interval = setInterval(function () {
            handleRatios(1, ratio1["titule"], ratio1["expression"], parseInt(Math.round((Math.random() * 100000.2) + 500)), ratio1["postResult"], ratio1["color"]);
            handleRatios(2, ratio2["titule"], ratio2["expression"], parseInt(Math.round((Math.random() * 100000.2) + 500)), ratio2["postResult"], ratio2["color"]);
            handleRatios(3, ratio3["titule"], ratio3["expression"], parseInt(Math.round((Math.random() * 100000.2) + 500)), ratio3["postResult"], ratio3["color"]);
            handleRatios(4, ratio4["titule"], ratio4["expression"], parseInt(Math.round((Math.random() * 100000.2) + 500)), ratio4["postResult"], ratio4["color"]);
        }, 2000);

    });


    function handleRatios(number, titule, operation, result, abrv, color) {
        $('#background_ratio' + number).attr('style', 'background-color: ' + color);
        $('#titule_ratio' + number).html(titule);
        $('#result_ratio' + number).html(ifIsFloatParsed(Number(result)) + (abrv.length > 0 ? (' ' + abrv) : ''));
        $('#operation_ratio' + number).html(operation);

    };

    function ifIsFloatParsed(n) {
        var num = Number(n);
        if (num == 'NaN') {
            return num;
        }
        if (Number(n) === n && n % 1 !== 0 && Number(n).toString().split(".")[1].length > 4) {
            return Number(Math.round(n + 'e4') + 'e-4');
        }
        return n;
    }
</script>
</body>
</html>